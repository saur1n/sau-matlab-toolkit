%%  Sau MATLAB Colony Analyzer Toolkit
%
%%  pos2coor2strainid_PT.m

%   Author: Saurin Parikh, March 2018
%   dr.saurin.parikh@gmail.com
    
%%  ENTIRE MAP

    connectSQL;

    plates = fetch(conn, ['select distinct 384plate ',...
     'from BARFLEX_SPACE_AGAR_PT where 384plate is not NULL ',...
     'order by 384plate asc']);

    strains = [-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;0;0;0;0;0;0;0;0;0;0;0;0;0;0;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2;-2];

    data = [];
    for i=1:length(plates.x384plate)
        bf = fetch(conn, sprintf(['select * from BARFLEX_SPACE_AGAR_PT ',...
            'where 384plate = %d ',...
            'order by 384plate, 384col, 384row'],plates.x384plate(i)));
        pos     = linspace(384*(i-1)'+1,384*i,384)';
        plate   = ones(384,1)*plates.x384plate(i);
        coor    = indices(384)';

        temp    = [pos, plate, coor, strains];

            for ii=1:length(bf.strain_id)
                temp(bf.x384row(ii) + 16*(bf.x384col(ii)-1),5) = bf.strain_id(ii);
            end
            
        data = [data;temp];
    end

    colnames = {'pos','384plate','384row','384col','strain_id'};

    datainsert(conn,'PT_384_MAP',colnames,data);

%%  pos2strain_id

    clear strains bf plates plate data pos coor temp colnames i ii
    
    plates = fetch(conn, ['select distinct 384plate ',...
     'from PT_384_MAP where 384plate is not NULL ',...
     'order by 384plate asc']);
 
    for i=1:length(plates.x384plate)
        data{plates.x384plate(i)} = fetch(conn,...
            sprintf(['select pos, strain_id from PT_384_MAP ',...
            'where 384plate = %d ',...
            'order by 384col, 384row'], plates.x384plate(i)));
    end

%   PS1 data

    data{101}.pos = grid2row(plategen(data{31}.pos, data{1}.pos,...
        data{2}.pos, data{3}.pos))'+10000;
    data{102}.pos = grid2row(plategen(data{4}.pos, data{32}.pos,...
        data{5}.pos, data{6}.pos))'+10000;
    data{103}.pos = grid2row(plategen(data{7}.pos, data{8}.pos,...
        data{33}.pos, data{9}.pos))'+10000;
    data{104}.pos = grid2row(plategen(data{10}.pos, data{11}.pos,...
        data{12}.pos, data{34}.pos))'+10000;
    data{105}.pos = grid2row(plategen(data{35}.pos, data{13}.pos,...
        data{14}.pos, data{15}.pos))'+10000;
    data{106}.pos = grid2row(plategen(data{16}.pos, data{36}.pos,...
        data{17}.pos, data{22}.pos))'+10000;    

    data{107}.pos = grid2row(plategen(data{1}.pos, data{3}.pos,...
        data{31}.pos, data{5}.pos))'+20000;
    data{108}.pos = grid2row(plategen(data{7}.pos, data{9}.pos,...
        data{11}.pos, data{32}.pos))'+20000;
    data{109}.pos = grid2row(plategen(data{33}.pos, data{13}.pos,...
        data{15}.pos, data{17}.pos))'+20000;
    data{110}.pos = grid2row(plategen(data{2}.pos, data{34}.pos,...
        data{4}.pos, data{6}.pos))'+20000;
    data{111}.pos = grid2row(plategen(data{8}.pos, data{10}.pos,...
        data{35}.pos, data{12}.pos))'+20000;
    data{112}.pos = grid2row(plategen(data{14}.pos, data{16}.pos,...
        data{22}.pos, data{36}.pos))'+20000;  
    
    data{113}.pos = grid2row(plategen(data{31}.pos, data{1}.pos,...
        data{4}.pos, data{7}.pos))'+30000;
    data{114}.pos = grid2row(plategen(data{10}.pos, data{32}.pos,...
        data{13}.pos, data{16}.pos))'+30000;
    data{115}.pos = grid2row(plategen(data{2}.pos, data{5}.pos,...
        data{33}.pos, data{8}.pos))'+30000;
    data{116}.pos = grid2row(plategen(data{11}.pos, data{14}.pos,...
        data{17}.pos, data{34}.pos))'+30000;
    data{117}.pos = grid2row(plategen(data{35}.pos, data{3}.pos,...
        data{6}.pos, data{9}.pos))'+30000;
    data{118}.pos = grid2row(plategen(data{12}.pos, data{36}.pos,...
        data{15}.pos, data{22}.pos))'+30000;   
    
    data{119}.pos = grid2row(plategen(data{1}.pos, data{5}.pos,...
        data{31}.pos, data{9}.pos))'+40000;
    data{120}.pos = grid2row(plategen(data{13}.pos, data{17}.pos,...
        data{2}.pos, data{32}.pos))'+40000;
    data{121}.pos = grid2row(plategen(data{33}.pos, data{6}.pos,...
        data{10}.pos, data{14}.pos))'+40000;
    data{122}.pos = grid2row(plategen(data{22}.pos, data{34}.pos,...
        data{3}.pos, data{7}.pos))'+40000;
    data{123}.pos = grid2row(plategen(data{11}.pos, data{15}.pos,...
        data{35}.pos, data{4}.pos))'+40000;
    data{124}.pos = grid2row(plategen(data{8}.pos, data{12}.pos,...
        data{16}.pos, data{36}.pos))'+40000; 
    
    
    data{101}.strain_id = grid2row(plategen(data{31}.strain_id, data{1}.strain_id,...
        data{2}.strain_id, data{3}.strain_id))';
    data{102}.strain_id = grid2row(plategen(data{4}.strain_id, data{32}.strain_id,...
        data{5}.strain_id, data{6}.strain_id))';
    data{103}.strain_id = grid2row(plategen(data{7}.strain_id, data{8}.strain_id,...
        data{33}.strain_id, data{9}.strain_id))';
    data{104}.strain_id = grid2row(plategen(data{10}.strain_id, data{11}.strain_id,...
        data{12}.strain_id, data{34}.strain_id))';
    data{105}.strain_id = grid2row(plategen(data{35}.strain_id, data{13}.strain_id,...
        data{14}.strain_id, data{15}.strain_id))';
    data{106}.strain_id = grid2row(plategen(data{16}.strain_id, data{36}.strain_id,...
        data{17}.strain_id, data{22}.strain_id))';    

    data{107}.strain_id = grid2row(plategen(data{1}.strain_id, data{3}.strain_id,...
        data{31}.strain_id, data{5}.strain_id))';
    data{108}.strain_id = grid2row(plategen(data{7}.strain_id, data{9}.strain_id,...
        data{11}.strain_id, data{32}.strain_id))';
    data{109}.strain_id = grid2row(plategen(data{33}.strain_id, data{13}.strain_id,...
        data{15}.strain_id, data{17}.strain_id))';
    data{110}.strain_id = grid2row(plategen(data{2}.strain_id, data{34}.strain_id,...
        data{4}.strain_id, data{6}.strain_id))';
    data{111}.strain_id = grid2row(plategen(data{8}.strain_id, data{10}.strain_id,...
        data{35}.strain_id, data{12}.strain_id))';
    data{112}.strain_id = grid2row(plategen(data{14}.strain_id, data{16}.strain_id,...
        data{22}.strain_id, data{36}.strain_id))';  
    
    data{113}.strain_id = grid2row(plategen(data{31}.strain_id, data{1}.strain_id,...
        data{4}.strain_id, data{7}.strain_id))';
    data{114}.strain_id = grid2row(plategen(data{10}.strain_id, data{32}.strain_id,...
        data{13}.strain_id, data{16}.strain_id))';
    data{115}.strain_id = grid2row(plategen(data{2}.strain_id, data{5}.strain_id,...
        data{33}.strain_id, data{8}.strain_id))';
    data{116}.strain_id = grid2row(plategen(data{11}.strain_id, data{14}.strain_id,...
        data{17}.strain_id, data{34}.strain_id))';
    data{117}.strain_id = grid2row(plategen(data{35}.strain_id, data{3}.strain_id,...
        data{6}.strain_id, data{9}.strain_id))';
    data{118}.strain_id = grid2row(plategen(data{12}.strain_id, data{36}.strain_id,...
        data{15}.strain_id, data{22}.strain_id))';   
    
    data{119}.strain_id = grid2row(plategen(data{1}.strain_id, data{5}.strain_id,...
        data{31}.strain_id, data{9}.strain_id))';
    data{120}.strain_id = grid2row(plategen(data{13}.strain_id, data{17}.strain_id,...
        data{2}.strain_id, data{32}.strain_id))';
    data{121}.strain_id = grid2row(plategen(data{33}.strain_id, data{6}.strain_id,...
        data{10}.strain_id, data{14}.strain_id))';
    data{122}.strain_id = grid2row(plategen(data{22}.strain_id, data{34}.strain_id,...
        data{3}.strain_id, data{7}.strain_id))';
    data{123}.strain_id = grid2row(plategen(data{11}.strain_id, data{15}.strain_id,...
        data{35}.strain_id, data{4}.strain_id))';
    data{124}.strain_id = grid2row(plategen(data{8}.strain_id, data{12}.strain_id,...
        data{16}.strain_id, data{36}.strain_id))'; 

    
%   PS2
    
    data{1001}.pos = grid2row(plategen(data{101}.pos, data{102}.pos,...
        data{103}.pos, data{104}.pos))'+100000;
    data{1002}.pos = grid2row(plategen(data{105}.pos, data{106}.pos,...
        data{107}.pos, data{108}.pos))'+100000;
    data{1003}.pos = grid2row(plategen(data{109}.pos, data{110}.pos,...
        data{111}.pos, data{112}.pos))'+100000;
    data{1004}.pos = grid2row(plategen(data{113}.pos, data{114}.pos,...
        data{115}.pos, data{116}.pos))'+100000;
    data{1005}.pos = grid2row(plategen(data{117}.pos, data{118}.pos,...
        data{119}.pos, data{120}.pos))'+100000;
    data{1006}.pos = grid2row(plategen(data{121}.pos, data{122}.pos,...
        data{123}.pos, data{124}.pos))'+100000;    

    data{1007}.pos = grid2row(plategen(data{101}.pos, data{106}.pos,...
        data{111}.pos, data{116}.pos))'+200000;
    data{1008}.pos = grid2row(plategen(data{105}.pos, data{110}.pos,...
        data{115}.pos, data{120}.pos))'+200000;
    data{1009}.pos = grid2row(plategen(data{109}.pos, data{114}.pos,...
        data{119}.pos, data{124}.pos))'+200000;
    data{1010}.pos = grid2row(plategen(data{113}.pos, data{118}.pos,...
        data{123}.pos, data{104}.pos))'+200000;
    data{1011}.pos = grid2row(plategen(data{117}.pos, data{122}.pos,...
        data{103}.pos, data{108}.pos))'+200000;
    data{1012}.pos = grid2row(plategen(data{121}.pos, data{102}.pos,...
        data{107}.pos, data{112}.pos))'+200000;  
    
    data{1013}.pos = grid2row(plategen(data{101}.pos, data{110}.pos,...
        data{119}.pos, data{104}.pos))'+300000;
    data{1014}.pos = grid2row(plategen(data{105}.pos, data{114}.pos,...
        data{123}.pos, data{108}.pos))'+300000;
    data{1015}.pos = grid2row(plategen(data{109}.pos, data{118}.pos,...
        data{103}.pos, data{112}.pos))'+300000;
    data{1016}.pos = grid2row(plategen(data{113}.pos, data{122}.pos,...
        data{107}.pos, data{116}.pos))'+300000;
    data{1017}.pos = grid2row(plategen(data{117}.pos, data{102}.pos,...
        data{111}.pos, data{120}.pos))'+300000;
    data{1018}.pos = grid2row(plategen(data{121}.pos, data{106}.pos,...
        data{115}.pos, data{124}.pos))'+300000;   
    
    data{2001}.pos = grid2row(plategen(data{101}.pos, data{102}.pos,...
        data{103}.pos, data{104}.pos))'+400000;
    data{2002}.pos = grid2row(plategen(data{105}.pos, data{106}.pos,...
        data{107}.pos, data{108}.pos))'+400000;
    data{2003}.pos = grid2row(plategen(data{109}.pos, data{110}.pos,...
        data{111}.pos, data{112}.pos))'+400000;
    data{2004}.pos = grid2row(plategen(data{113}.pos, data{114}.pos,...
        data{115}.pos, data{116}.pos))'+400000;
    data{2005}.pos = grid2row(plategen(data{117}.pos, data{118}.pos,...
        data{119}.pos, data{120}.pos))'+400000;
    data{2006}.pos = grid2row(plategen(data{121}.pos, data{122}.pos,...
        data{123}.pos, data{124}.pos))'+400000;
    
    
    
    data{1001}.strain_id = grid2row(plategen(data{101}.strain_id, data{102}.strain_id,...
        data{103}.strain_id, data{104}.strain_id))';
    data{1002}.strain_id = grid2row(plategen(data{105}.strain_id, data{106}.strain_id,...
        data{107}.strain_id, data{108}.strain_id))';
    data{1003}.strain_id = grid2row(plategen(data{109}.strain_id, data{110}.strain_id,...
        data{111}.strain_id, data{112}.strain_id))';
    data{1004}.strain_id = grid2row(plategen(data{113}.strain_id, data{114}.strain_id,...
        data{115}.strain_id, data{116}.strain_id))';
    data{1005}.strain_id = grid2row(plategen(data{117}.strain_id, data{118}.strain_id,...
        data{119}.strain_id, data{120}.strain_id))';
    data{1006}.strain_id = grid2row(plategen(data{121}.strain_id, data{122}.strain_id,...
        data{123}.strain_id, data{124}.strain_id))';    

    data{1007}.strain_id = grid2row(plategen(data{101}.strain_id, data{106}.strain_id,...
        data{111}.strain_id, data{116}.strain_id))';
    data{1008}.strain_id = grid2row(plategen(data{105}.strain_id, data{110}.strain_id,...
        data{115}.strain_id, data{120}.strain_id))';
    data{1009}.strain_id = grid2row(plategen(data{109}.strain_id, data{114}.strain_id,...
        data{119}.strain_id, data{124}.strain_id))';
    data{1010}.strain_id = grid2row(plategen(data{113}.strain_id, data{118}.strain_id,...
        data{123}.strain_id, data{104}.strain_id))';
    data{1011}.strain_id = grid2row(plategen(data{117}.strain_id, data{122}.strain_id,...
        data{103}.strain_id, data{108}.strain_id))';
    data{1012}.strain_id = grid2row(plategen(data{121}.strain_id, data{102}.strain_id,...
        data{107}.strain_id, data{112}.strain_id))';  
    
    data{1013}.strain_id = grid2row(plategen(data{101}.strain_id, data{110}.strain_id,...
        data{119}.strain_id, data{104}.strain_id))';
    data{1014}.strain_id = grid2row(plategen(data{105}.strain_id, data{114}.strain_id,...
        data{123}.strain_id, data{108}.strain_id))';
    data{1015}.strain_id = grid2row(plategen(data{109}.strain_id, data{118}.strain_id,...
        data{103}.strain_id, data{112}.strain_id))';
    data{1016}.strain_id = grid2row(plategen(data{113}.strain_id, data{122}.strain_id,...
        data{107}.strain_id, data{116}.strain_id))';
    data{1017}.strain_id = grid2row(plategen(data{117}.strain_id, data{102}.strain_id,...
        data{111}.strain_id, data{120}.strain_id))';
    data{1018}.strain_id = grid2row(plategen(data{121}.strain_id, data{106}.strain_id,...
        data{115}.strain_id, data{124}.strain_id))';   
    
    data{2001}.strain_id = grid2row(plategen(data{101}.strain_id, data{102}.strain_id,...
        data{103}.strain_id, data{104}.strain_id))';
    data{2002}.strain_id = grid2row(plategen(data{105}.strain_id, data{106}.strain_id,...
        data{107}.strain_id, data{108}.strain_id))';
    data{2003}.strain_id = grid2row(plategen(data{109}.strain_id, data{110}.strain_id,...
        data{111}.strain_id, data{112}.strain_id))';
    data{2004}.strain_id = grid2row(plategen(data{113}.strain_id, data{114}.strain_id,...
        data{115}.strain_id, data{116}.strain_id))';
    data{2005}.strain_id = grid2row(plategen(data{117}.strain_id, data{118}.strain_id,...
        data{119}.strain_id, data{120}.strain_id))';
    data{2006}.strain_id = grid2row(plategen(data{121}.strain_id, data{122}.strain_id,...
        data{123}.strain_id, data{124}.strain_id))';   
 
   colnames = {'pos','strain_id'};
   
   for i=1:length(data)
       if isempty(data{i}) ~= 1
           datainsert(conn,'PT_pos2strainid',colnames,data{i})
       end
   end
   
%%  pos2coor

% PT_384_pos2coor was made within sql using the PT_384_MAP table

    ii = 1;
    for i=1:length(data)
        if isempty(data{i}) ~= 1
            coor{ii}.pos = data{i}.pos;
            ii = ii + 1;
        end
    end
    
    pl384 = [1:17,22,31,32,33,34,35,36];
    ind384 = indices(384)';
    ind1536 = indices(1536)';
    ind6144 = indices(6144)';
    
    for i=1:length(coor)
        if i <= 24
            coor{i}.x384plate = ones(length(coor{i}.pos),1)*pl384(i);
            coor{i}.x384row = ind384(:,1);
            coor{i}.x384col = ind384(:,2);
        elseif i <= 48
            coor{i}.x1536plate = ones(length(coor{i}.pos),1)*(i-24);
            coor{i}.x1536row = ind1536(:,1);
            coor{i}.x1536col = ind1536(:,2);
        else
            coor{i}.x6144plate = ones(length(coor{i}.pos),1)*(i-48);
            coor{i}.x6144row = ind6144(:,1);
            coor{i}.x6144col = ind6144(:,2);
        end
    end
    
    colnames1536 = {'pos','x1536plate','x1536row','x1536col'};
    colnames6144 = {'pos','x6144plate','x6144row','x6144col'};
    
    for i=25:48
        datainsert(conn,'PT_1536_pos2coor',colnames1536,coor{i})
    end
    
    for i=49:72
        datainsert(conn,'PT_6144_pos2coor',colnames6144,coor{i})
    end
    
%%
    conn(close);
    
    
  